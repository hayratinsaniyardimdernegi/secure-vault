<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hayrat Yardım - Şifre Kasası</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Favicon - Hayrat Yardım -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231B5E20'/%3E%3Cstop offset='100%25' stop-color='%234CAF50'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23g)'/%3E%3Cpath d='M50 10 C25 10 10 30 10 50 C10 70 25 90 50 90 C75 90 90 70 90 50 C90 30 75 10 50 10 M50 15 C72 15 85 32 85 50 C85 68 72 85 50 85 C28 85 15 68 15 50 C15 32 28 15 50 15' fill='%23ffffff' opacity='0.3'/%3E%3Cellipse cx='50' cy='50' rx='35' ry='35' fill='none' stroke='%23ffffff' stroke-width='2' opacity='0.5'/%3E%3Cpath d='M50 15 L50 85 M15 50 L85 50' stroke='%23ffffff' stroke-width='1.5' opacity='0.4'/%3E%3Cpath d='M50 15 C35 15 25 30 25 50 C25 70 35 85 50 85' fill='none' stroke='%23ffffff' stroke-width='1.5' opacity='0.4'/%3E%3Cpath d='M50 15 C65 15 75 30 75 50 C75 70 65 85 50 85' fill='none' stroke='%23ffffff' stroke-width='1.5' opacity='0.4'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="images/logo_yatay.png">
</head>
<body>
    <!-- Vault Selection Modal -->
    <div class="modal-backdrop" id="vault-selection-modal">
        <div class="modal modal-lg">
            <div class="modal-body">
                <div class="modal-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                    </svg>
                </div>
                <h2>Kasa Seçin</h2>
                <p class="text-muted mt-md mb-lg">
                    Mevcut bir kasayı açın veya yeni bir kasa oluşturun.
                </p>

                <div id="vault-list" class="vault-list">
                    <!-- Populated by JS -->
                </div>

                <div class="button-group mt-lg">
                    <button class="btn btn-primary btn-full" id="open-existing-vault-btn">
                        Seçili Kasayı Aç
                    </button>
                    <button class="btn btn-secondary btn-full mt-sm" id="create-new-vault-btn">
                        Yeni Kasa Oluştur
                    </button>
                    <button class="btn btn-outline btn-full mt-sm" id="modal-logout-btn-selection">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16,17 21,12 16,7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Çıkış Yap
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Vault Modal -->
    <div class="modal-backdrop hidden" id="create-vault-modal">
        <div class="modal">
            <div class="modal-body">
                <div class="modal-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="32" height="32">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h2>Yeni Kasa Oluştur</h2>
                <p class="text-muted mt-md mb-md">
                    Kasanıza bir isim verin ve ana şifre belirleyin.
                </p>

                <div class="info-box mb-lg">
                    <strong>Önemli:</strong> Ana şifreniz bu kasadaki tüm şifreleri şifreler. 
                    Sunucularımıza asla gönderilmez ve unutulursa kurtarılamaz.
                </div>

                <div class="message message-error hidden" id="create-vault-error"></div>

                <div class="form-group">
                    <label class="form-label" for="new-vault-name">Kasa Adı</label>
                    <input 
                        type="text" 
                        id="new-vault-name" 
                        class="form-input" 
                        placeholder="örn: Kişisel, İş, Finans"
                        autocomplete="off"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="new-vault-master-password">Ana Şifre</label>
                    <input 
                        type="password" 
                        id="new-vault-master-password" 
                        class="form-input form-input-password" 
                        placeholder="Güçlü bir ana şifre oluşturun"
                        autocomplete="off"
                    >
                    <div class="password-strength">
                        <div class="password-strength-bar-container">
                            <div class="password-strength-bar" id="new-vault-password-strength-bar"></div>
                        </div>
                        <span class="password-strength-text" id="new-vault-password-strength-text"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="new-vault-confirm-password">Ana Şifre Tekrar</label>
                    <input 
                        type="password" 
                        id="new-vault-confirm-password" 
                        class="form-input form-input-password" 
                        placeholder="Ana şifrenizi tekrar girin"
                        autocomplete="off"
                    >
                </div>

                <div class="button-group mt-lg">
                    <button class="btn btn-primary btn-full" id="confirm-create-vault-btn">
                        Kasa Oluştur
                    </button>
                    <button class="btn btn-secondary btn-full mt-sm" id="cancel-create-vault-btn">
                        İptal
                    </button>
                    <button class="btn btn-outline btn-full mt-sm" id="modal-logout-btn-create">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16,17 21,12 16,7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Çıkış Yap
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Unlock Modal (master password) -->
    <div class="modal-backdrop hidden" id="unlock-modal">
        <div class="modal">
            <div class="modal-body">
                <div class="modal-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="32" height="32">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h2>Kasayı Aç</h2>
                <p class="text-muted mt-md mb-md" id="unlock-vault-name">
                    Bu kasayı açmak için ana şifrenizi girin.
                </p>

                <div class="message message-error hidden" id="unlock-error"></div>

                <div class="form-group">
                    <label class="form-label" for="master-password">Ana Şifre</label>
                    <input 
                        type="password" 
                        id="master-password" 
                        class="form-input form-input-password" 
                        placeholder="Ana şifrenizi girin"
                        autocomplete="off"
                    >
                </div>

                <button class="btn btn-primary btn-full" id="unlock-btn">
                    Kasayı Aç
                </button>

                <p class="text-muted text-center mt-lg security-note">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                    </svg>
                    Ana şifreniz yerel olarak kullanılır ve sunucularımıza asla gönderilmez.
                </p>

                <button class="btn btn-ghost btn-full mt-md" id="back-to-vault-selection-btn">
                    ← Kasa Seçimine Dön
                </button>
                
                <button class="btn btn-outline btn-full mt-sm" id="modal-logout-btn-unlock">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Çıkış Yap
                </button>
            </div>
        </div>
    </div>

    <!-- Add / Edit Password Modal -->
    <div class="modal-backdrop hidden" id="add-modal">
        <div class="modal modal-lg">
            <div class="modal-body">
                <h2 id="add-modal-title">Şifre Ekle</h2>
                <p class="text-muted mt-md mb-lg">
                    Bu kayıt şifrelenecek ve mevcut kasada saklanacaktır.
                </p>

                <div class="message message-error hidden" id="add-error"></div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="site-name">Site / Uygulama Adı *</label>
                        <input 
                            type="text" 
                            id="site-name" 
                            class="form-input" 
                            placeholder="örn: Gmail, Netflix, GitHub"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="site-url">URL (isteğe bağlı)</label>
                        <input 
                            type="url" 
                            id="site-url" 
                            class="form-input" 
                            placeholder="https://ornek.com"
                        >
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="username">Kullanıcı Adı / E-posta *</label>
                        <input 
                            type="text" 
                            id="username" 
                            class="form-input" 
                            placeholder="kullanici@email.com"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="password">Şifre *</label>
                        <div class="input-group">
                            <input 
                                type="password" 
                                id="password" 
                                class="form-input" 
                                placeholder="••••••••"
                                required
                            >
                            <button class="btn btn-secondary input-group-btn" id="generate-password-btn" type="button">
                                Oluştur
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="notes">Notlar (isteğe bağlı)</label>
                    <textarea 
                        id="notes" 
                        class="form-input" 
                        rows="3" 
                        placeholder="Güvenlik soruları, kurtarma kodları vb."
                    ></textarea>
                </div>

                <div class="button-group mt-lg">
                    <button class="btn btn-primary btn-full" id="save-password-btn">
                        Şifreyi Kaydet
                    </button>
                    <button class="btn btn-secondary btn-full mt-sm" id="cancel-add-btn">
                        İptal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div class="modal-backdrop hidden" id="delete-modal">
        <div class="modal">
            <div class="modal-body">
                <div class="modal-icon modal-icon-danger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="32" height="32">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </div>
                <h2>Şifreyi Sil</h2>
                <p class="text-muted mt-md mb-lg">
                    Bu şifreyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
                </p>

                <div class="button-group">
                    <button class="btn btn-danger btn-full" id="confirm-delete-btn">Şifreyi Sil</button>
                    <button class="btn btn-secondary btn-full mt-sm" id="cancel-delete-btn">İptal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Vault Modal -->
    <div class="modal-backdrop hidden" id="delete-vault-modal">
        <div class="modal">
            <div class="modal-body">
                <div class="modal-icon modal-icon-danger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="32" height="32">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </div>
                <h2>Kasayı Sil</h2>
                <p class="text-muted mt-md mb-md">
                    "<span class="delete-vault-name" id="delete-vault-name"></span>" kasasını silmek istediğinizden emin misiniz?
                </p>
                <p class="text-muted mb-lg" style="font-size: 0.8125rem;">
                    Bu işlem kasayı ve içindeki tüm şifreleri kalıcı olarak silecektir. Bu işlem geri alınamaz.
                </p>

                <div class="button-group">
                    <button class="btn btn-danger btn-full" id="confirm-delete-vault-btn">Kasayı Sil</button>
                    <button class="btn btn-secondary btn-full mt-sm" id="cancel-delete-vault-btn">İptal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="container app-header-inner">
            <div class="app-logo">
                <img src="images/logo_yatay.png" alt="Hayrat Yardım Logo" class="header-logo-image">
            </div>

            <div class="app-header-actions">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar"></div>
                    <span class="user-email" id="user-email"></span>
                </div>
                <button class="btn btn-secondary btn-sm" id="lock-btn" title="Kasayı kilitle ve kasa seçimine dön">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Kilitle
                </button>
                <button class="btn btn-outline btn-sm" id="logout-btn" title="Hesabınızdan çıkış yapın">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Çıkış Yap
                </button>
            </div>
        </div>
    </header>

    <!-- Main Vault Content -->
    <main class="vault-container hidden" id="vault-container">
        <div class="container">
            <div class="vault-header">
                <div class="vault-title-area">
                    <h2 id="current-vault-name">Kasam</h2>
                    <p class="text-muted" id="current-vault-subtitle">
                        <span class="vault-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="12" height="12">
                                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                            </svg>
                            Şifreli
                        </span>
                    </p>
                </div>
                <div class="vault-header-actions">
                    <div class="vault-search">
                        <svg class="vault-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="search-input" 
                            placeholder="Şifrelerde ara..."
                        >
                    </div>
                    <button class="btn btn-primary" id="add-new-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Şifre Ekle
                    </button>
                </div>
            </div>

            <div class="vault-content">
                <div class="empty-state" id="empty-state">
                    <div class="empty-state-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="48" height="48">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </div>
                    <h3>Henüz şifre yok</h3>
                    <p class="text-muted">
                        Bu kasa boş. İlk şifreli şifrenizi saklamak için "Şifre Ekle"ye tıklayın.
                    </p>
                </div>

                <div class="password-list hidden" id="password-list">
                    <!-- Password cards populated by JS -->
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabaseClient.js"></script>
    <script src="js/crypto.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/vault.js"></script>
</body>
</html>
